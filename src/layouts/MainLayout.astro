---
const { title } = Astro.props;
import Intro from "@components/Intro.svelte";
import Head from "@components/Head.svelte";
import Header from "@components/Header/index.svelte";
---

<!DOCTYPE html>
<html lang="en">
    <Head {title}/>

    <body>
        <Intro client:load/>

        <div class="main-content">
            <Header client:load/>
    
            <div class="smooth-wrapper">
                <div id="smooth-content">
                    <div class="grain">
                        <div class="grain-pattern"></div>
                    </div>
                    <main id="swup">
                        <slot/>
                    </main>
                </div>
            </div>
        </div>
        <script>
            console.log("BEFORE PAGE LIFECYCLE");
            gsap.registerPlugin(ScrollTrigger, ScrollSmoother);
        
            // Smooth Scrollbar + GSAP ScrollTrigger
            const scroll_smoother = ScrollSmoother.create({
                smooth: 1.25,
                effects: true,
                smoothTouch: true,
            });
        
            console.log("BEFORE TO ABOUT IN");
            const to_about_in = next => {
                gsap.to("#swup", {
                    onComplete: next,
                });
            }
            console.log("AFTER TO ABOUT IN");
        
            console.log("BEFORE TO FROM WORK OUT");
            const from_work_out = next => {
                gsap.to("#swup", {
                    duration: 0.8,
                    onComplete: next,
                });
        
                gsap.to("#work-section", {
                    duration: 0.65,
                    opacity: 0,
                    yPercent: -300,
                    stagger: 0.015,
                    ease: "power2.in",
                });
            }
            console.log("AFTER TO FROM WORK OUT");
        
            console.log("BEFORE TO WORK IN");
            const to_work_in = next => {
                gsap.fromTo("#swup", {
                    duration: 0.5,
                    autoAlpha: 0,
                }, {
                    ease: "power1.out",
                    autoAlpha: 1,
                    yPercent: 0,
                    onComplete: next,
                });
        
                gsap.fromTo("#work-section", {
                    duration: 0.5,
                    yPercent: 120,
                }, {
                    ease: "power1.out",
                    yPercent: 0,
                    stagger: 0.04,
                });
            }
            console.log("AFTER TO WORK IN");
        
            console.log("BEFORE FROM ABOUT OUT");
            const from_about_out = next => {
                gsap.to("#swup", {
                    duration: 0.65,
                    ease: "power4.out",
                    autoAlpha: 0,
                    onComplete: next,
                });
            }
            console.log("AFTER FROM ABOUT OUT");
        
            // TODO Try fix this (scroll 0 instead of 1)
            const start_from_page_top = () => scroll_smoother.scrollTop(1);
        
            new Swup({
                animateHistoryBrowsing: true,
                plugins: [
                    new SwupHeadPlugin(),
                    new SwupJsPlugin([
                        {
                            from: "/",
                            to: "/about",
                            in: next => to_about_in(next),
                            out: next => from_work_out(next),
                        },
                        {
                            from: "/about",
                            to: "/",
                            in: next => to_work_in(next),
                            out: next => from_about_out(next),
                        },
                    ]),
                ],
            }).on("pageView", start_from_page_top);
            console.log("AFTER PAGE LIFECYCLE");
        </script>
    </body>
</html>

<style is:global>
    @import "./resets.css";
    @import "./colors.css";
    @import "./fonts.css";

    :root {
        font-family: var(--display-font);
        font-weight: 500;
        font-feature-settings: "lnum";
        color-scheme: light dark;

        /* Font smoothing */
        font-synthesis: none;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-text-size-adjust: 100%;

        /* Non-selectable text */
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        cursor: default;

        /* Colors */
        color: var(--fg-color);
        background-color: var(--bg-color);
    }

    /* Hide scrollbar */
    * {
        /* Firefox */
        scrollbar-width: none;
    }
    body::-webkit-scrollbar {
        display: none;
    }

    @media (prefers-color-scheme: light) {
        :root {
            --fg-color: var(--night);
            --bg-color: var(--bone);
        }
    }
    @media (prefers-color-scheme: dark) {
        :root {
            --fg-color: var(--smoke);
            --bg-color: var(--night);
        }
    }

    code {
        font-family: "Fira Code", Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace;
    }

    .main-content {
        visibility: hidden;
    }

    .grain {
        position: fixed;
        width: 100%;
        height: 1000000vh;
        opacity: 0.03;
    }

    .grain-pattern {
        position: absolute;
        width: 100%;
        height: 100%;
        background-image: url("/grain.gif");
    }
</style>
